<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate 2.4 GHz Cantenna Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            chtml: {
                scale: 1.1 // Slightly scale up math fonts
            },
            options: {
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=JetBrains+Mono:wght@400;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: #e2e8f0;
        }
        .font-mono {
            font-family: 'JetBrains Mono', monospace;
        }
        .math-block {
            overflow-x: auto;
            padding: 1.5rem;
            background: #1e293b;
            border-radius: 0.5rem;
            margin: 1.5rem 0;
            border: 1px solid #334155;
            font-size: 1.35rem; /* Increased font size for better readability */
            color: #e2e8f0;
            display: flex;
            justify-content: center;
        }
        .diagram-container {
            position: relative;
            width: 100%;
            height: 340px; /* Increased height for extra label */
            background: #1e293b;
            border-radius: 0.5rem;
            overflow: hidden;
            border: 1px solid #334155;
        }
        .highlight {
            color: #38bdf8;
            font-weight: bold;
        }
        .warning {
            color: #fbbf24;
        }
        input[type="number"] {
            background-color: #334155;
            border: 1px solid #475569;
            color: white;
        }
        input[type="number"]:focus {
            outline: none;
            border-color: #38bdf8;
            ring: 2px solid #38bdf8;
        }
    </style>
</head>
<body class="antialiased min-h-screen flex flex-col">

    <!-- Navigation / Header -->
    <header class="bg-slate-900 border-b border-slate-800 sticky top-0 z-50">
        <div class="max-w-5xl mx-auto px-4 py-4 flex justify-between items-center">
            <a href="#" class="flex items-center gap-3 hover:opacity-80 transition">
                <i class="fas fa-wifi text-sky-400 text-2xl"></i>
                <h1 class="text-xl font-bold tracking-tight text-white">Cantenna<span class="text-sky-400">Architect</span></h1>
            </a>
            <nav class="hidden md:flex gap-6 text-sm font-medium text-slate-400">
                <a href="#theory" class="hover:text-white transition">Theory</a>
                <a href="#calculator" class="hover:text-white transition">Calculator</a>
                <a href="#construction" class="hover:text-white transition">Construction</a>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="py-12 md:py-20 bg-gradient-to-b from-slate-900 to-slate-800">
        <div class="max-w-4xl mx-auto px-4 text-center">
            <h2 class="text-4xl md:text-5xl font-bold text-white mb-6">Designing the Circular Waveguide</h2>
            <p class="text-lg text-slate-300 leading-relaxed max-w-2xl mx-auto">
                You have the LMR-400, the N-connector, and the copper. Now you need the math. 
                This guide bridges the gap between generic internet tutorials and electromagnetic engineering.
            </p>
            <div class="mt-8 flex justify-center gap-4">
                <a href="#calculator" class="bg-sky-500 hover:bg-sky-600 text-white px-6 py-3 rounded-lg font-semibold transition shadow-lg shadow-sky-500/20">
                    Design Your Can
                </a>
                <a href="#construction" class="bg-slate-700 hover:bg-slate-600 text-white px-6 py-3 rounded-lg font-semibold transition">
                    View Build Steps
                </a>
            </div>
        </div>
    </section>

    <!-- Theory Section -->
    <section id="theory" class="py-16 max-w-4xl mx-auto px-4">
        <div class="flex items-center gap-3 mb-8">
            <div class="bg-sky-500/10 p-3 rounded-full text-sky-400">
                <i class="fas fa-book-open"></i>
            </div>
            <h3 class="text-3xl font-bold text-white">1. The Physics of the Can</h3>
        </div>

        <div class="space-y-8 text-slate-300">
            <div class="bg-slate-800/50 p-6 rounded-xl border border-slate-700">
                <h4 class="text-xl font-semibold text-white mb-3">It's not an antenna, it's a Feed & Waveguide</h4>
                <p class="mb-4">
                    Your copper wire is the actual antenna (a monopole). The can is a <strong>circular waveguide</strong>. It directs the energy in a single direction. However, radio waves travel differently inside a tube than they do in open air. This is the most critical concept to understand.
                </p>
                <p>
                    Inside the can, the wave bounces off the walls. This "bouncing" slows down the phase velocity of the wave. Therefore, the wavelength inside the can ($ \lambda_g $) is <strong>longer</strong> than the wavelength in free space ($ \lambda_0 $).
                </p>
            </div>

            <div>
                <h4 class="text-xl font-semibold text-white mb-4">The "Mode" Dilemma</h4>
                <p class="mb-4">
                    We want the radio wave to propagate in the dominant mode, known as <strong>TE<sub>11</sub></strong> (Transverse Electric 11). This mode matches the orientation of your single copper probe.
                </p>
                <p class="mb-4">
                    However, if the can is too wide, it allows a secondary mode called <strong>TM<sub>01</sub></strong>. This is bad. It causes interference and signal loss.
                </p>
                <ul class="list-disc pl-6 space-y-2 marker:text-sky-400">
                    <li><strong>Can too small:</strong> The wave cannot enter (Cutoff). Like trying to fit a basketball in a golf hole.</li>
                    <li><strong>Can too big:</strong> Multiple modes exist (TE<sub>11</sub> + TM<sub>01</sub>). The signal gets "confused" and efficient transmission drops.</li>
                    <li><strong>Sweet Spot:</strong> We need a diameter where TE<sub>11</sub> passes, but TM<sub>01</sub> is blocked.</li>
                </ul>
            </div>
        </div>
    </section>

    <!-- Formulas Section -->
    <section class="py-16 bg-slate-800/30 border-y border-slate-800">
        <div class="max-w-4xl mx-auto px-4">
            <div class="flex items-center gap-3 mb-8">
                <div class="bg-purple-500/10 p-3 rounded-full text-purple-400">
                    <i class="fas fa-square-root-variable"></i>
                </div>
                <h3 class="text-3xl font-bold text-white">2. The Governing Formulas</h3>
            </div>

            <div class="grid gap-8">
                <!-- Step 1: Free Space -->
                <div>
                    <h4 class="text-lg font-semibold text-sky-300">A. Free Space Wavelength ($\lambda_0$)</h4>
                    <p class="text-slate-400 text-sm mb-2">The length of the wave in open air.</p>
                    <div class="math-block">
                        $$ \lambda_0 = \frac{c}{f} $$
                    </div>
                    <p class="text-slate-400 text-sm">Where $c$ is the speed of light ($299,792,458$ m/s) and $f$ is frequency (2.437 GHz).</p>
                </div>

                <!-- Step 2: Cutoff -->
                <div>
                    <h4 class="text-lg font-semibold text-sky-300">B. Cutoff Conditions (Selecting Diameter $D$)</h4>
                    <p class="text-slate-400 text-sm mb-2">To act as a proper waveguide, the diameter $D$ must satisfy:</p>
                    <div class="math-block">
                        $$ \frac{\lambda_0}{1.706} < D < \frac{\lambda_0}{1.306} $$
                    </div>
                    <p class="text-slate-400 text-sm">
                        Lower Limit ($TE_{11}$ cutoff): $\approx 72$ mm.<br>
                        Upper Limit ($TM_{01}$ cutoff): $\approx 94$ mm.
                    </p>
                </div>

                <!-- Step 3: Guide Wavelength -->
                <div>
                    <h4 class="text-lg font-semibold text-sky-300">C. Guide Wavelength ($\lambda_g$)</h4>
                    <p class="text-slate-400 text-sm mb-2">The length of the wave <strong>inside</strong> the can. This is the number we build with.</p>
                    <div class="math-block">
                        $$ \lambda_g = \frac{\lambda_0}{\sqrt{1 - \left( \frac{\lambda_0}{1.706 D} \right)^2}} $$
                    </div>
                </div>

                <!-- Step 4: Dimensions -->
                <div>
                    <h4 class="text-lg font-semibold text-sky-300">D. Construction Dimensions</h4>
                    <p class="text-slate-300 mb-4 text-sm">
                        The total length of the can is crucial. We need $\frac{1}{4}\lambda_g$ behind the probe for reflection, and at least $\frac{1}{2}\lambda_g$ in front of it for the wave to launch.
                    </p>
                    <div class="grid md:grid-cols-3 gap-4 mt-4">
                        <div class="bg-slate-800 p-4 rounded border border-slate-700">
                            <span class="block text-sm text-slate-400">Probe Location (S)</span>
                            <div class="py-2 flex justify-center">
                                <span class="text-2xl text-white">$$ S = \frac{\lambda_g}{4} $$</span>
                            </div>
                            <p class="text-xs text-slate-500 mt-2">Back wall to copper wire.</p>
                        </div>
                        <div class="bg-slate-800 p-4 rounded border border-slate-700">
                            <span class="block text-sm text-slate-400">Probe Height (L)</span>
                            <div class="py-2 flex justify-center">
                                <span class="text-2xl text-white">$$ L = \frac{\lambda_0}{4} $$</span>
                            </div>
                            <p class="text-xs text-slate-500 mt-2">Copper wire length.</p>
                        </div>
                        <div class="bg-slate-800 p-4 rounded border border-slate-700 border-l-4 border-l-sky-500">
                            <span class="block text-sm text-slate-400">Min. Can Length</span>
                            <div class="py-2 flex justify-center">
                                <span class="text-2xl text-white">$$ \approx 0.75 \lambda_g $$</span>
                            </div>
                            <p class="text-xs text-slate-500 mt-2">Minimum total tube length.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Calculator Section -->
    <section id="calculator" class="py-16 max-w-4xl mx-auto px-4">
        <div class="bg-slate-800 rounded-2xl p-6 md:p-10 border border-slate-700 shadow-2xl">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-2xl font-bold text-white"><i class="fas fa-calculator text-green-400 mr-2"></i> Can Calculator</h3>
                <span class="text-xs font-mono bg-slate-900 px-2 py-1 rounded text-slate-400">Freq: 2.437 GHz (Ch 6)</span>
            </div>

            <p class="text-slate-300 mb-6">
                Measure the <span class="text-sky-400 font-bold">inner diameter</span> of your can. Enter it below to see if it is suitable and get your drilling measurements.
            </p>

            <div class="flex flex-col md:flex-row gap-6 items-start">
                <div class="w-full md:w-1/3">
                    <div class="flex justify-between items-center mb-2">
                        <label class="block text-sm font-medium text-slate-400">Inner Diameter</label>
                        <div class="flex bg-slate-900 rounded border border-slate-700 overflow-hidden">
                            <button type="button" onclick="setUnit('cm')" id="btn-cm" class="px-3 py-1 text-xs font-bold bg-sky-500 text-white transition">cm</button>
                            <button type="button" onclick="setUnit('mm')" id="btn-mm" class="px-3 py-1 text-xs font-bold text-slate-400 hover:bg-slate-800 hover:text-white transition">mm</button>
                        </div>
                    </div>
                    <input type="number" id="canDiameter" placeholder="e.g. 8.5" class="w-full p-3 rounded-lg text-lg font-mono shadow-inner" step="0.1" oninput="calculateDimensions()">
                    <div class="flex justify-between items-center mt-2">
                        <p class="text-xs text-slate-500" id="rangeHelper">
                            <i class="fas fa-info-circle"></i> Ideal range: 8.0cm - 9.2cm
                        </p>
                        <button onclick="resetCalculator()" class="text-xs text-slate-500 hover:text-sky-400 transition flex items-center gap-1" title="Reset to defaults">
                            <i class="fas fa-rotate-left"></i> Reset
                        </button>
                    </div>
                </div>

                <div class="w-full md:w-2/3 bg-slate-900 rounded-xl p-6 border border-slate-700" id="resultsPanel">
                    <!-- Dynamic Results go here -->
                    <div class="text-center text-slate-500 h-full flex flex-col justify-center">
                        <i class="fas fa-arrow-left text-2xl mb-2 md:hidden"></i>
                        <p>Enter diameter to calculate</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Step by Step Construction -->
    <section id="construction" class="py-16 max-w-4xl mx-auto px-4">
        <div class="flex items-center gap-3 mb-10">
            <div class="bg-orange-500/10 p-3 rounded-full text-orange-400">
                <i class="fas fa-tools"></i>
            </div>
            <h3 class="text-3xl font-bold text-white">3. Construction Guide</h3>
        </div>

        <div class="space-y-12">
            
            <!-- Step 1 -->
            <div class="relative pl-8 border-l-2 border-slate-700">
                <div class="absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-sky-500"></div>
                <h4 class="text-xl font-bold text-white mb-2">Step 1: Can Selection & Cleaning</h4>
                <p class="text-slate-300 mb-4">
                    Based on the calculator above, select a straight-walled metal can. 
                    <span class="text-sky-300">Coffee cans, stew cans, or paint thinner cans</span> usually fall in the 85-100mm range.
                    Avoid ribbed cans (corrugation ruins the wave pattern).
                </p>
                <div class="bg-yellow-500/10 border-l-4 border-yellow-500 p-4 text-yellow-200 text-sm">
                    <strong>Common Myth:</strong> Pringles cans (approx 75mm) are actually suboptimal. They operate barely above the cutoff frequency, leading to high signal attenuation. A metal coffee can (~100mm) or formula tin is physically superior.
                </div>
            </div>

            <!-- Step 2 -->
            <div class="relative pl-8 border-l-2 border-slate-700">
                <div class="absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-sky-500"></div>
                <h4 class="text-xl font-bold text-white mb-2">Step 2: Prepare the Copper Probe</h4>
                <p class="text-slate-300 mb-4">
                    You are using a <strong>1.5mm pure copper wire</strong>. This acts as the radiating element.
                </p>
                <ol class="list-decimal ml-5 space-y-2 text-slate-300">
                    <li>Take your N-type Female Chassis connector.</li>
                    <li>Straighten a small section of your copper wire coil.</li>
                    <li>Solder the copper wire into the solder cup of the N-connector pin. Ensure it is perfectly vertical.</li>
                    <li><strong>Crucial Measurement:</strong> The total length of the probe (from the flat face of the brass connector to the tip of the copper) must be exactly <span class="font-mono text-sky-400">30.7mm</span> (which is $\lambda_0/4$).</li>
                    <li>Trim the wire carefully. File the tip to be smooth (sharp points can leak corona discharge, though unlikely at wifi power levels, it's bad practice).</li>
                </ol>
            </div>

            <!-- Step 3 -->
            <div class="relative pl-8 border-l-2 border-slate-700">
                <div class="absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-sky-500"></div>
                <h4 class="text-xl font-bold text-white mb-2">Step 3: Drilling the Can</h4>
                <p class="text-slate-300 mb-4">
                    The location of the hole determines the impedance match.
                </p>
                <ul class="list-disc ml-5 space-y-2 text-slate-300">
                    <li>Measure from the <strong>inside bottom</strong> of the can. If the can has a lip, measure from the actual metal floor.</li>
                    <li>Mark the distance calculated as "Probe Position" ($S$).</li>
                    <li>Drill a hole sized for your N-type connector (usually 5/8" or 16mm, check your specific connector specs).</li>
                    <li>Sand the area around the hole down to bare metal to ensure a good ground connection with the connector body.</li>
                </ul>
            </div>

            <!-- Step 4 -->
            <div class="relative pl-8 border-l-2 border-slate-700">
                <div class="absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-sky-500"></div>
                <h4 class="text-xl font-bold text-white mb-2">Step 4: Assembly & Cabling</h4>
                <p class="text-slate-300 mb-4">
                    Mount the connector with the probe inside. Use screws and nuts to secure the chassis connector to the can.
                </p>
                <div class="grid md:grid-cols-2 gap-6 mt-4">
                    <div class="bg-slate-800 p-4 rounded border border-slate-700">
                        <h5 class="font-semibold text-white mb-2">LMR-400 Management</h5>
                        <p class="text-sm text-slate-400">
                            You have 1m and 1.5m LMR-400 cables. These are <strong>heavy and stiff</strong>. 
                            Connecting a thick LMR-400 directly to a light tin can will tip it over.
                            <br><br>
                            <strong>Solution:</strong> Mount the can to a tripod or a wooden block. Use zip ties to secure the LMR-400 to the mount so the weight doesn't stress the N-connector solder joint.
                        </p>
                    </div>
                    <div class="bg-slate-800 p-4 rounded border border-slate-700">
                        <h5 class="font-semibold text-white mb-2">Connection Chain</h5>
                        <p class="text-sm text-slate-400 font-mono">
                            WiFi Router (RP-SMA) <br>
                            ↓ <br>
                            LMR-400 (RP-SMA to N-Male) <br>
                            ↓ <br>
                            Cantenna (N-Female)
                        </p>
                    </div>
                </div>
            </div>

        </div>
    </section>

    <!-- Visual Diagram -->
    <section class="py-12 bg-slate-900 border-t border-slate-800">
        <div class="max-w-4xl mx-auto px-4">
            <h3 class="text-2xl font-bold text-white mb-6 text-center">Visual Reference</h3>
            <div class="diagram-container flex items-center justify-center bg-slate-950">
                <!-- SVG Diagram -->
                <svg width="600" height="320" viewBox="0 0 600 320" xmlns="http://www.w3.org/2000/svg">
                    <!-- Can Body -->
                    <defs>
                        <linearGradient id="canGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#334155;stop-opacity:1" />
                            <stop offset="50%" style="stop-color:#475569;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#334155;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    
                    <!-- The Can Cylinder -->
                    <rect x="50" y="40" width="400" height="200" fill="url(#canGrad)" stroke="#94a3b8" stroke-width="2"/>
                    <!-- Back Wall -->
                    <line x1="50" y1="40" x2="50" y2="240" stroke="#cbd5e1" stroke-width="4"/>
                    
                    <!-- The Probe -->
                    <line x1="150" y1="240" x2="150" y2="160" stroke="#f59e0b" stroke-width="4" stroke-linecap="round"/>
                    <!-- Connector Base -->
                    <rect x="140" y="240" width="20" height="10" fill="#fbbf24"/>
                    
                    <!-- Dimensions -->
                    <!-- Probe Position S -->
                    <line x1="50" y1="260" x2="150" y2="260" stroke="#38bdf8" stroke-width="2"/>
                    <text x="85" y="275" fill="#38bdf8" font-family="monospace" font-size="14">S = λg/4</text>
                    
                    <!-- Probe Length L -->
                    <line x1="170" y1="240" x2="170" y2="160" stroke="#38bdf8" stroke-width="2"/>
                    <text x="180" y="200" fill="#38bdf8" font-family="monospace" font-size="14">L = λo/4</text>

                    <!-- Total Length -->
                    <line x1="50" y1="295" x2="450" y2="295" stroke="#22c55e" stroke-width="2" stroke-dasharray="4"/>
                    <line x1="50" y1="290" x2="50" y2="300" stroke="#22c55e" stroke-width="2"/>
                    <line x1="450" y1="290" x2="450" y2="300" stroke="#22c55e" stroke-width="2"/>
                    <text x="190" y="315" fill="#22c55e" font-family="monospace" font-size="14">Min Length ≈ 0.75 λg</text>
                    
                    <!-- Waves representation -->
                    <path d="M 160 140 Q 220 40 280 140 T 400 140" fill="none" stroke="rgba(255,255,255,0.2)" stroke-width="2" stroke-dasharray="5,5"/>
                    <path d="M 160 140 Q 220 240 280 140 T 400 140" fill="none" stroke="rgba(255,255,255,0.2)" stroke-width="2" stroke-dasharray="5,5"/>

                    <!-- Labels -->
                    <text x="460" y="140" fill="#94a3b8" font-size="14">Open End</text>
                    <text x="10" y="140" fill="#94a3b8" font-size="14" transform="rotate(-90 20,140)">Back Wall</text>
                    <text x="130" y="150" fill="#f59e0b" font-size="12" font-weight="bold">Copper Element</text>
                </svg>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="py-8 text-center text-slate-500 text-sm bg-slate-900 border-t border-slate-800">
        <p>Generated for 2.4 GHz Wi-Fi Optimization.</p>
        <p class="mt-2">Safety Warning: Always wear eye protection when drilling. Be careful with copper wire ends.</p>
    </footer>

    <script>
        // Force the page to start at the top on load/refresh
        if (history.scrollRestoration) {
            history.scrollRestoration = 'manual';
        }
        window.scrollTo(0, 0);

        let currentUnit = 'cm';

        function setUnit(unit) {
            currentUnit = unit;
            
            // Update Button UI
            const btnCm = document.getElementById('btn-cm');
            const btnMm = document.getElementById('btn-mm');
            const input = document.getElementById('canDiameter');
            const helper = document.getElementById('rangeHelper');

            if (unit === 'cm') {
                btnCm.className = "px-3 py-1 text-xs font-bold bg-sky-500 text-white transition";
                btnMm.className = "px-3 py-1 text-xs font-bold text-slate-400 hover:bg-slate-800 hover:text-white transition";
                input.placeholder = "e.g. 8.5";
                helper.innerHTML = '<i class="fas fa-info-circle"></i> Ideal range: 8.0cm - 9.2cm';
            } else {
                btnMm.className = "px-3 py-1 text-xs font-bold bg-sky-500 text-white transition";
                btnCm.className = "px-3 py-1 text-xs font-bold text-slate-400 hover:bg-slate-800 hover:text-white transition";
                input.placeholder = "e.g. 85";
                helper.innerHTML = '<i class="fas fa-info-circle"></i> Ideal range: 80mm - 92mm';
            }

            // Trigger recalculation if a value exists
            if (input.value) {
                calculateDimensions();
            }
        }

        function resetCalculator() {
            // Clear Input
            document.getElementById('canDiameter').value = '';
            
            // Reset Unit to Default (cm)
            setUnit('cm');

            // Reset Results Panel to Initial State
            document.getElementById('resultsPanel').innerHTML = `
                <div class="text-center text-slate-500 h-full flex flex-col justify-center">
                    <i class="fas fa-arrow-left text-2xl mb-2 md:hidden"></i>
                    <p>Enter diameter to calculate</p>
                </div>`;
        }

        function calculateDimensions() {
            const input = document.getElementById('canDiameter');
            const resultsPanel = document.getElementById('resultsPanel');
            let val = parseFloat(input.value);

            if (!val || isNaN(val)) {
                resultsPanel.innerHTML = `
                    <div class="text-center text-slate-500 h-full flex flex-col justify-center">
                        <p>Enter diameter to calculate</p>
                    </div>`;
                return;
            }

            // Normalize to millimeters for calculation
            let D_mm = currentUnit === 'cm' ? val * 10 : val;

            // Constants for 2.437 GHz (Channel 6 center)
            const f = 2437000000; 
            const c = 299792458000; // Speed of light in mm/s
            const lambda_0 = c / f; // Free space wavelength in mm (~123mm)

            // Cutoff Calculations
            const cut_TE11 = lambda_0 / 1.706; // Lower limit
            const cut_TM01 = lambda_0 / 1.306; // Upper limit

            let statusHTML = '';
            let isViable = false;

            if (D_mm < cut_TE11) {
                statusHTML = `<div class="text-red-400 font-bold mb-2"><i class="fas fa-times-circle"></i> Too Small</div>
                <p class="text-sm text-slate-400">This diameter acts as a high-pass filter blocking 2.4GHz. The wave cannot enter the can.</p>`;
            } else if (D_mm > cut_TM01) {
                statusHTML = `<div class="text-orange-400 font-bold mb-2"><i class="fas fa-exclamation-triangle"></i> Too Large</div>
                <p class="text-sm text-slate-400">This diameter allows multi-mode propagation (TE11 + TM01). It will work, but efficiency and directionality will be unpredictable.</p>`;
                isViable = true; // Technically works, just poorly
            } else {
                statusHTML = `<div class="text-green-400 font-bold mb-2"><i class="fas fa-check-circle"></i> Excellent</div>
                <p class="text-sm text-slate-400">This diameter perfectly supports the dominant mode while suppressing higher modes.</p>`;
                isViable = true;
            }

            // Calculations
            let guideWavelengthVal = "N/A";
            let probePos = "N/A";
            let minLength = "N/A";
            let probeHeight = (lambda_0 / 4).toFixed(2); // Always calc in mm first
            
            if (D_mm > cut_TE11) {
                // Calculate Guide Wavelength
                const ratio = lambda_0 / (1.706 * D_mm);
                const lambda_g = lambda_0 / Math.sqrt(1 - Math.pow(ratio, 2));
                
                // Store raw mm values
                let gw_mm = lambda_g;
                let pp_mm = lambda_g / 4;
                let ml_mm = lambda_g * 0.75;

                // Format based on unit
                if (currentUnit === 'cm') {
                    guideWavelengthVal = (gw_mm / 10).toFixed(2);
                    probePos = (pp_mm / 10).toFixed(2);
                    minLength = (ml_mm / 10).toFixed(2);
                } else {
                    guideWavelengthVal = gw_mm.toFixed(2);
                    probePos = pp_mm.toFixed(2);
                    minLength = ml_mm.toFixed(2);
                }
            }

            // Format Probe Height based on unit
            if (currentUnit === 'cm') {
                probeHeight = (parseFloat(probeHeight) / 10).toFixed(2);
            }

            resultsPanel.innerHTML = `
                <div class="border-b border-slate-700 pb-4 mb-4">
                    ${statusHTML}
                </div>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                    <div>
                        <span class="text-slate-500 text-xs uppercase tracking-wide">Probe Position (S)</span>
                        <div class="text-2xl font-mono text-white">${probePos} <span class="text-sm text-slate-500">${currentUnit}</span></div>
                        <div class="text-xs text-slate-500">From back wall</div>
                    </div>
                    <div>
                        <span class="text-slate-500 text-xs uppercase tracking-wide">Probe Height (L)</span>
                        <div class="text-2xl font-mono text-white">${probeHeight} <span class="text-sm text-slate-500">${currentUnit}</span></div>
                        <div class="text-xs text-slate-500">Total copper length</div>
                    </div>
                    <div>
                        <span class="text-slate-500 text-xs uppercase tracking-wide">Min. Can Length</span>
                        <div class="text-2xl font-mono text-green-400">${minLength} <span class="text-sm text-slate-500">${currentUnit}</span></div>
                        <div class="text-xs text-slate-500">Total tube length</div>
                    </div>
                    <div class="col-span-2 md:col-span-3 mt-2 bg-slate-800 p-2 rounded flex justify-between items-center">
                         <div>
                             <span class="text-slate-500 text-xs uppercase tracking-wide">Guide Wavelength</span>
                             <span class="text-slate-400 text-sm ml-1">($\\lambda_g$)</span>
                         </div>
                         <div class="text-lg font-mono text-sky-400">${guideWavelengthVal} <span class="text-sm text-slate-500">${currentUnit}</span></div>
                    </div>
                </div>
            `;
            
            // Re-render MathJax for the dynamic content
            if(window.MathJax && window.MathJax.typesetPromise) {
                window.MathJax.typesetPromise([resultsPanel]).catch(err => console.log('MathJax error:', err));
            }
        }
    </script>
</body>
</html>
